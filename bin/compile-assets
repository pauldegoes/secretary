#!/usr/bin/env bash

# Asset compilation script for Secretary application
# Ensures CSS is compiled before Rails startup

set -e

echo "ğŸ”¨ Compiling assets..."

# Check if yarn is available
if ! command -v yarn &> /dev/null; then
    echo "âŒ Error: yarn is not installed"
    echo "Please install yarn: npm install -g yarn"
    exit 1
fi

# Check if dependencies are installed
if [ ! -d "node_modules" ]; then
    echo "ğŸ“¦ Installing Node.js dependencies..."
    yarn install
fi

# Compile CSS assets
echo "ğŸ¨ Compiling Tailwind CSS..."
yarn build:css

# Verify CSS was created
if [ ! -f "app/assets/builds/application.css" ]; then
    echo "âŒ Error: CSS compilation failed"
    exit 1
fi

echo "âœ… Assets compiled successfully!"
echo "ğŸ“ CSS file: app/assets/builds/application.css"
echo "ğŸ“Š File size: $(du -h app/assets/builds/application.css | cut -f1)"
